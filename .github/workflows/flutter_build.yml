name: 📱 Simple ARM64 Build

on:
  push:
    branches: [ main, develop ]
  workflow_dispatch:

env:
  FLUTTER_VERSION: '3.32.1'
  JAVA_VERSION: '21'

jobs:
  build-arm64:
    name: 🏗️ Build ARM64 APK
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v4

    - name: ☕ Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: ${{ env.JAVA_VERSION }}

    - name: ⚡ Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: ${{ env.FLUTTER_VERSION }}
        channel: 'stable'
        cache: true

    - name: 🔧 Install dependencies
      run: |
        flutter pub get

    - name: 📱 Build ARM64 APK
      run: |
        flutter build apk \
          --release \
          --target-platform android-arm64 \
          --verbose

    - name: 📦 Prepare APK
      run: |
        mkdir -p release
        
        # Find the APK
        if [ -f "build/app/outputs/flutter-apk/app-release.apk" ]; then
          cp build/app/outputs/flutter-apk/app-release.apk release/t3r-c0d3-arm64.apk
        elif [ -f "build/app/outputs/apk/release/app-release.apk" ]; then
          cp build/app/outputs/apk/release/app-release.apk release/t3r-c0d3-arm64.apk
        else
          # Find any APK
          find build/app/outputs -name "*.apk" -exec cp {} release/t3r-c0d3-arm64.apk \; -quit
        fi
        
        echo "📱 APK Ready:"
        ls -lah release/

    - name: 📤 Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: t3r-c0d3-arm64-apk
        path: release/t3r-c0d3-arm64.apk
        retention-days: 30